version: 2
jobs:
  build:
    docker:
      - image: tkosht/webapi:latest
    steps:
      - checkout
      - run: rm -rf frontend/node_modules frontend/user_data
      - run: cd frontend && user_data && npm ci
  pytest:
    docker:
      - image: tkosht/webapi:latest
    steps:
      - checkout
      - run: cd backend && python -m pytest test
  jest:
    docker:
      - image: tkosht/webapi:latest
    steps:
      - checkout
      - run: cd frontend && npm run unit
  e2e:
    docker:
      - image: tkosht/webapi:latest
    steps:
      - checkout
      - run: cd frontend && npm run e2e
    requires:
      - build

workflows:
  version: 2
  workflow_tests:
    jobs:
    - build
    - pytest
    - jest
    - e2e

